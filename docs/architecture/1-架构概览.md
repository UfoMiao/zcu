# 1. 架构概览

## 1.1 系统架构愿景

ZCU采用现代化微服务架构设计，通过LevelDB + Shadow Repository的轻量级存储方案，结合React双重渲染架构（CLI + Web），实现跨平台统一的用户体验。核心创新在于AI工作空间隔离机制，解决多Claude实例并发操作的冲突问题，为Claude Code用户提供企业级的undo/redo功能。

## 1.2 核心架构原则

### 1.2.1 设计哲学
- **用户主控**: 避免AI幻觉问题，所有关键操作由用户确认
- **轻量高效**: 最小化资源占用，快速响应用户操作
- **平台无关**: 一套代码，多端运行，保持功能和体验一致
- **容错设计**: 零数据丢失，故障自动恢复
- **扩展友好**: 模块化设计，支持插件化扩展

### 1.2.2 技术选型原则
- **成熟稳定**: 优选经过大规模验证的技术栈
- **社区活跃**: 选择有活跃社区支持的开源方案
- **轻量优先**: 避免过度工程化，保持架构简洁
- **标准兼容**: 遵循Web标准和Node.js生态规范

## 1.3 整体系统架构

```mermaid
graph TB
    subgraph "客户端层 Client Layer"
        CLI[CLI Terminal UI<br/>Ink + React]
        WEB[Web Dashboard<br/>Next.js + React]
        CMD[Command Interface<br/>Natural Language]
    end
    
    subgraph "共享组件层 Shared Components"
        COMP[React共享组件库<br/>Business Logic + UI]
        HOOKS[共享Hooks<br/>State Management]
        UTILS[工具函数<br/>Common Utilities]
    end
    
    subgraph "API服务层 API Service Layer"
        CORE[ZCU Core API<br/>Express + TypeScript]
        AUTH[认证服务<br/>Session Management]
        HOOKS_SVC[Hook服务<br/>Event Processing]
    end
    
    subgraph "业务逻辑层 Business Logic Layer"
        UNDO[Undo/Redo Engine<br/>Operation Management]
        WORKSPACE[AI Workspace<br/>Isolation Manager]
        CONFLICT[Conflict Resolver<br/>Merge Engine]
        SNAPSHOT[Snapshot Manager<br/>Version Control]
    end
    
    subgraph "存储层 Storage Layer"
        LEVELDB[(LevelDB<br/>Metadata & Sessions)]
        SHADOW[(Shadow Repository<br/>File Snapshots)]
        CACHE[(Memory Cache<br/>Hot Data)]
    end
    
    subgraph "集成层 Integration Layer"
        CLAUDE[Claude Code Hooks<br/>AI Operation Events]
        GIT[Git Integration<br/>Version Control)]
        FS[File System<br/>Project Files]
    end
    
    CLI --> COMP
    WEB --> COMP
    CMD --> COMP
    
    COMP --> CORE
    HOOKS --> CORE
    UTILS --> CORE
    
    CORE --> UNDO
    CORE --> WORKSPACE
    CORE --> CONFLICT
    CORE --> SNAPSHOT
    
    UNDO --> LEVELDB
    WORKSPACE --> LEVELDB
    CONFLICT --> SHADOW
    SNAPSHOT --> SHADOW
    
    CORE --> CACHE
    
    HOOKS_SVC --> CLAUDE
    SNAPSHOT --> GIT
    UNDO --> FS
```

---
